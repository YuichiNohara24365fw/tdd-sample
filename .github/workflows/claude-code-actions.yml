name: Claude Code Actions

on:
  issue_comment:
    types: [created]
  pull_request_comment:
    types: [created]
  issues:
    types: [opened, assigned]

permissions:
  contents: write
  pull-requests: write
  issues: write
  actions: read

jobs:
  claude-response:
    runs-on: ubuntu-latest
    name: "Claude AI Assistant"
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && contains(github.event.issue.title, '[CLAUDE]'))
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # ãƒ•ãƒ«ãƒ’ã‚¹ãƒˆãƒªãƒ¼ã‚’å–å¾—ï¼ˆã‚³ãƒ¼ãƒ‰åˆ†æã®ãŸã‚ï¼‰
        fetch-depth: 0
        
    - name: Claude Code Assistant
      uses: anthropics/claude-code-action@beta
      with:
        # èªè¨¼è¨­å®šï¼ˆMaxãƒ—ãƒ©ãƒ³ OAuthæ–¹å¼ï¼‰
        claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        github_token: ${{ secrets.GITHUB_TOKEN }}
        
        # Claude 4 ãƒ¢ãƒ‡ãƒ«è¨­å®šï¼ˆ2025å¹´5æœˆãƒªãƒªãƒ¼ã‚¹ï¼‰
        model: "claude-opus-4-20250514"
        fallback_model: "claude-sonnet-4-20250514"
        
        # ãƒˆãƒªã‚¬ãƒ¼è¨­å®š
        trigger_phrase: "@claude"
        
        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆé•·æ™‚é–“å‡¦ç†å¯¾å¿œ - å®Ÿé¨“çš„æœ€å¤§å€¤ï¼‰
        timeout_minutes: 180

       # ğŸ‘ˆ ã“ã®è¡Œã‚’è¿½åŠ 
        allowed-tools: 'npm,npx,node,playwright,chrome,firefox,xvfb-run,apt-get,dpkg'

        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šã¯CLAUDE.mdãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©